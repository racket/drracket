#
# Makefile for mzscheme
#

# dynlink is a script that uses the right set of link commands
DYNLINK = mzc --ld 

srcdir = @srcdir@

CC = @CC@
CFLAGS = @CFLAGS@ -I$(srcdir)/../include -I$(srcdir)/../src

dynlib:
	$(MAKE) ../mzdyn.o

dynlib2k:
	$(MAKE) ../mzdyn2k.o

dynexample:
	$(MAKE) ../dynexmpl.so

oe:
	$(MAKE) ../oe.so

HEADERS = $(srcdir)/../include/scheme.h $(srcdir)/../src/schemef.h \
          $(srcdir)/../sconfig.h $(srcdir)/../uconfig.h

MZDYNDEP = ../mzdyn.o $(srcdir)/../include/ext.exp $(srcdir)/../include/mzscheme.exp

../mzdyn.o: $(srcdir)/mzdyn.c $(srcdir)/../src/schvers.h  $(HEADERS)
	$(CC) $(CFLAGS) -c $(srcdir)/mzdyn.c -o ../mzdyn.o

../mzdyn2k.o: $(srcdir)/mzdyn.c $(srcdir)/../src/schvers.h  $(HEADERS)
	$(CC) $(CFLAGS) -DMZ_PRECISE_GC -c $(srcdir)/mzdyn.c -o ../mzdyn2k.o

../dynexmpl.so: dynexmpl.o $(MZDYNDEP)
	$(DYNLINK) ../dynexmpl.so dynexmpl.o
dynexmpl.o: $(srcdir)/dynexmpl.c  $(HEADERS)
	$(CC) $(CFLAGS) -c $(srcdir)/dynexmpl.c -o dynexmpl.o

../oe.so: oe.o  $(MZDYNDEP)
	$(DYNLINK) ../oe.so oe.o
oe.o: $(srcdir)/oe.c $(HEADERS)
	$(CC) $(CFLAGS) -c $(srcdir)/oe.c -o oe.o

clean:
	/bin/rm -f *.o Makefile.bak

# Note: 'make depend' is no longer required. As distributed, the below
#       dependencies have been trimmed to include only dependencies
#       on MzScheme files

# DO NOT DELETE THIS LINE -- make depend depends on it.

mzdyn.o: $(srcdir)/../include/escheme.h $(srcdir)/../include/scheme.h $(srcdir)/../src/stypes.h \
         $(srcdir)/../src/schemex.h $(srcdir)/../src/schemexm.h $(srcdir)/../src/schvers.h

dynexmpl.o: $(srcdir)/../include/escheme.h $(srcdir)/../include/scheme.h $(srcdir)/../src/schemexm.h 

oe.o: $(srcdir)/../include/escheme.h $(srcdir)/../include/scheme.h $(srcdir)/../src/stypes.h \
      $(srcdir)/../src/schemex.h $(srcdir)/../src/schemexm.h
